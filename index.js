#!usr/bin/env node

/**
 * File: index.js
 * Type: Javascript index file
 * Author: Chris Humboldt
**/

!function(e,t){"object"==typeof exports&&exports&&"string"!=typeof exports.nodeName?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):(e.Mustache={},t(e.Mustache))}(this,function(e){function t(e){return"function"==typeof e}function n(e){return v(e)?"array":typeof e}function r(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function o(e,t){return null!=e&&"object"==typeof e&&t in e}function i(e,t){return m.call(e,t)}function s(e){return!i(g,e)}function a(e){return String(e).replace(/[&<>"'`=\/]/g,function(e){return y[e]})}function c(t,n){function o(){if(g&&!y)for(;m.length;)delete d[m.pop()];else m=[];g=!1,y=!1}function i(e){if("string"==typeof e&&(e=e.split(b,2)),!v(e)||2!==e.length)throw new Error("Invalid tags: "+e);a=new RegExp(r(e[0])+"\\s*"),c=new RegExp("\\s*"+r(e[1])),p=new RegExp("\\s*"+r("}"+e[1]))}if(!t)return[];var a,c,p,h=[],d=[],m=[],g=!1,y=!1;i(n||e.tags);for(var j,N,T,U,D,A,I=new l(t);!I.eos();){if(j=I.pos,T=I.scanUntil(a))for(var S=0,M=T.length;M>S;++S)U=T.charAt(S),s(U)?m.push(d.length):y=!0,d.push(["text",U,j,j+1]),j+=1,"\n"===U&&o();if(!I.scan(a))break;if(g=!0,N=I.scan(k)||"name",I.scan(w),"="===N?(T=I.scanUntil(x),I.scan(x),I.scanUntil(c)):"{"===N?(T=I.scanUntil(p),I.scan(E),I.scanUntil(c),N="&"):T=I.scanUntil(c),!I.scan(c))throw new Error("Unclosed tag at "+I.pos);if(D=[N,T,j,I.pos],d.push(D),"#"===N||"^"===N)h.push(D);else if("/"===N){if(A=h.pop(),!A)throw new Error('Unopened section "'+T+'" at '+j);if(A[1]!==T)throw new Error('Unclosed section "'+A[1]+'" at '+j)}else"name"===N||"{"===N||"&"===N?y=!0:"="===N&&i(T)}if(A=h.pop())throw new Error('Unclosed section "'+A[1]+'" at '+I.pos);return f(u(d))}function u(e){for(var t,n,r=[],o=0,i=e.length;i>o;++o)t=e[o],t&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(r.push(t),n=t));return r}function f(e){for(var t,n,r=[],o=r,i=[],s=0,a=e.length;a>s;++s)switch(t=e[s],t[0]){case"#":case"^":o.push(t),i.push(t),o=t[4]=[];break;case"/":n=i.pop(),n[5]=t[2],o=i.length>0?i[i.length-1][4]:r;break;default:o.push(t)}return r}function l(e){this.string=e,this.tail=e,this.pos=0}function p(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function h(){this.cache={}}var d=Object.prototype.toString,v=Array.isArray||function(e){return"[object Array]"===d.call(e)},m=RegExp.prototype.test,g=/\S/,y={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},w=/\s*/,b=/\s+/,x=/\s*=/,E=/\s*\}/,k=/#|\^|\/|>|\{|&|=|!/;l.prototype.eos=function(){return""===this.tail},l.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},l.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},p.prototype.push=function(e){return new p(e,this)},p.prototype.lookup=function(e){var n,r=this.cache;if(r.hasOwnProperty(e))n=r[e];else{for(var i,s,a=this,c=!1;a;){if(e.indexOf(".")>0)for(n=a.view,i=e.split("."),s=0;null!=n&&s<i.length;)s===i.length-1&&(c=o(n,i[s])),n=n[i[s++]];else n=a.view[e],c=o(a.view,e);if(c)break;a=a.parent}r[e]=n}return t(n)&&(n=n.call(this.view)),n},h.prototype.clearCache=function(){this.cache={}},h.prototype.parse=function(e,t){var n=this.cache,r=n[e];return null==r&&(r=n[e]=c(e,t)),r},h.prototype.render=function(e,t,n){var r=this.parse(e),o=t instanceof p?t:new p(t);return this.renderTokens(r,o,n,e)},h.prototype.renderTokens=function(e,t,n,r){for(var o,i,s,a="",c=0,u=e.length;u>c;++c)s=void 0,o=e[c],i=o[0],"#"===i?s=this.renderSection(o,t,n,r):"^"===i?s=this.renderInverted(o,t,n,r):">"===i?s=this.renderPartial(o,t,n,r):"&"===i?s=this.unescapedValue(o,t):"name"===i?s=this.escapedValue(o,t):"text"===i&&(s=this.rawValue(o)),void 0!==s&&(a+=s);return a},h.prototype.renderSection=function(e,n,r,o){function i(e){return s.render(e,n,r)}var s=this,a="",c=n.lookup(e[1]);if(c){if(v(c))for(var u=0,f=c.length;f>u;++u)a+=this.renderTokens(e[4],n.push(c[u]),r,o);else if("object"==typeof c||"string"==typeof c||"number"==typeof c)a+=this.renderTokens(e[4],n.push(c),r,o);else if(t(c)){if("string"!=typeof o)throw new Error("Cannot use higher-order sections without the original template");c=c.call(n.view,o.slice(e[3],e[5]),i),null!=c&&(a+=c)}else a+=this.renderTokens(e[4],n,r,o);return a}},h.prototype.renderInverted=function(e,t,n,r){var o=t.lookup(e[1]);return!o||v(o)&&0===o.length?this.renderTokens(e[4],t,n,r):void 0},h.prototype.renderPartial=function(e,n,r){if(r){var o=t(r)?r(e[1]):r[e[1]];return null!=o?this.renderTokens(this.parse(o),n,r,o):void 0}},h.prototype.unescapedValue=function(e,t){var n=t.lookup(e[1]);return null!=n?n:void 0},h.prototype.escapedValue=function(t,n){var r=n.lookup(t[1]);return null!=r?e.escape(r):void 0},h.prototype.rawValue=function(e){return e[1]},e.name="mustache.js",e.version="2.2.1",e.tags=["{{","}}"];var j=new h;e.clearCache=function(){return j.clearCache()},e.parse=function(e,t){return j.parse(e,t)},e.render=function(e,t,r){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+n(e)+'" was given as the first argument for mustache#render(template, view, partials)');return j.render(e,t,r)},e.to_html=function(n,r,o,i){var s=e.render(n,r,o);return t(i)?void i(s):s},e.escape=a,e.Scanner=l,e.Context=p,e.Writer=h});var Web=function(e){if(!e.exists){var t=function(e){return null!==e&&e!==!1&&"undefined"!=typeof e};e.exists=t}if(!e.has){var n={spaces:function(e){return/\s/.test(e)},"class":function(e,t){return(" "+e.className+" ").indexOf(" "+t+" ")>-1}};e.has=n}if(!e["class"]){var r={add:function(e,o){if(t(e))if("object"==typeof o)for(var i=0,s=o.length;s>i;i++)r.addExecute(e,o[i]);else if(n.spaces(o))for(var a=o.split(" "),i=0,s=a.length;s>i;i++)r.addExecute(e,a[i]);else r.addExecute(e,o)},addExecute:function(e,t){var n=e.className;null===n.match(new RegExp("\\b"+t+"\\b","g"))&&(e.className=""===n?t:n+" "+t)},clear:function(e){t(e)&&e.removeAttribute("class")},remove:function(e,o){if(t(e))if("object"==typeof o)for(var i=o.length-1;i>=0;i--)r.removeExecute(e,o[i]);else if(n.spaces(o))for(var s=o.split(" "),i=0,a=s.length;a>i;i++)r.removeExecute(e,s[i]);else r.removeExecute(e,o)},removeExecute:function(e,t){e.className.indexOf(t)>-1&&(e.className=e.className.split(" ").filter(function(e){return e!=t}).toString().replace(/,/g," "),""===e.className&&r.clear(e))}};e["class"]=r}return e.dom||(e.dom={}),e.dom.select||(e.dom.select=function(e){if(e.indexOf(".")>-1||n.spaces(e)){var t=document.querySelectorAll(e);return t.length>0?t:!1}if(e.indexOf("#")>-1)return[document.getElementById(e.substring(1))];var t=document.getElementsByTagName(e);return t.length>0?t:!1}),e}(Web||{}),Injectplate=function(){var e={errors:!0},t=function(){var t={},n=function(e){if("object"!=typeof e||void 0==e.component)return!1;var n=void 0!=typeof e.to?Web.dom.select(e.to):Web.dom.select("#"+e.component);if(!n||n.length<1)return!1;for(var r=Mustache.render(t[e.component].html,e.data),o=0,i=n.length;i>o;o++)e.overwrite===!0?n[o].innerHTML=r:n[o].insertAdjacentHTML("beforeend",r),n[o].setAttribute("data-inject","true"),"string"==typeof t[e.component].id&&(n[o].id=t[e.components].id),"string"==typeof t[e.component].className&&Web["class"].add(n[o],t[e.component].className),"function"==typeof t[e.component].onDone&&t[e.component].onDone(n[o]),"function"==typeof e.onDone&&e.onDone(n[o])},r=function(t,n){if("object"==typeof t){for(var r="",o=0,i=t.length;i>o;o++)r+=t[o];return r}if("string"==typeof t){for(var r="",s=t.split(/(?:\r\n|\n|\r)/),o=0,i=s.length;i>o;o++)r+=s[o].trim();return r}if(e.errors)throw new Error('Injectplate: The HTML provided to create the component "'+n+'" is not valid.');return""},o=function(e){if("object"!=typeof e||void 0==e.component)return!1;var n=Mustache.render(t[e.component].html,e.data);return"function"==typeof e.onDone&&e.onDone(n),n},i=function(n){if("object"!=typeof n||void 0==n.name){if(e.errors)throw new Error("Injectplate: Please provide a valid component name.");return!1}t[n.name]={className:"string"==typeof n.className?n.className:!1,id:"string"==typeof n.id?n.id:!1,html:r(n.html,n.name),onDone:"function"==typeof n.onDone?n.onDone:!1,overwrite:"boolean"==typeof n.overwrite?n.overwrite:!1}};return{bind:n,component:i,flatten:r,generate:o,list:t}},n=function(){return new t};return{defaults:e,init:n}}();

module.exports = Injectplate.init();
